{
  "version": 3,
  "sources": ["../src/download.ts", "../src/youtube.ts", "../src/main.ts"],
  "sourcesContent": ["export async function downloadAsFile(url: string, filename: string): Promise<void> {\n  const response = await fetch(url, { mode: \"cors\" });\n  if (!response.ok) {\n    throw new Error(`Fetch failed: ${response.status}`);\n  }\n\n  const blob = await response.blob();\n  const objectUrl = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n\n  link.href = objectUrl;\n  link.download = filename;\n  link.target = \"_self\";\n  document.body.appendChild(link);\n  link.click();\n  link.remove();\n\n  URL.revokeObjectURL(objectUrl);\n}\n", "export type ThumbnailVariant = {\n  name: \"maxres\" | \"sd\" | \"hq\" | \"mq\" | \"default\";\n  url: string;\n};\n\nconst VIDEO_ID_REGEX = /^[a-zA-Z0-9_-]{11}$/;\n\nexport function extractVideoId(raw: string): string | null {\n  const value = String(raw ?? \"\").trim();\n  if (!value) {\n    return null;\n  }\n\n  if (VIDEO_ID_REGEX.test(value)) {\n    return value;\n  }\n\n  let parsed: URL;\n  try {\n    parsed = new URL(value);\n  } catch {\n    return null;\n  }\n\n  if (parsed.hostname.includes(\"youtu.be\")) {\n    const [id] = parsed.pathname.split(\"/\").filter(Boolean);\n    return id && VIDEO_ID_REGEX.test(id) ? id : null;\n  }\n\n  const videoParam = parsed.searchParams.get(\"v\");\n  if (videoParam && VIDEO_ID_REGEX.test(videoParam)) {\n    return videoParam;\n  }\n\n  const parts = parsed.pathname.split(\"/\").filter(Boolean);\n  const shortsIndex = parts.indexOf(\"shorts\");\n  if (shortsIndex !== -1) {\n    const candidate = parts[shortsIndex + 1];\n    if (candidate && VIDEO_ID_REGEX.test(candidate)) {\n      return candidate;\n    }\n  }\n\n  const embedIndex = parts.indexOf(\"embed\");\n  if (embedIndex !== -1) {\n    const candidate = parts[embedIndex + 1];\n    if (candidate && VIDEO_ID_REGEX.test(candidate)) {\n      return candidate;\n    }\n  }\n\n  return null;\n}\n\nexport function makeCandidates(id: string): ThumbnailVariant[] {\n  return [\n    { name: \"maxres\", url: `https://img.youtube.com/vi/${id}/maxresdefault.jpg` },\n    { name: \"sd\", url: `https://img.youtube.com/vi/${id}/sddefault.jpg` },\n    { name: \"hq\", url: `https://img.youtube.com/vi/${id}/hqdefault.jpg` },\n    { name: \"mq\", url: `https://img.youtube.com/vi/${id}/mqdefault.jpg` },\n    { name: \"default\", url: `https://img.youtube.com/vi/${id}/default.jpg` },\n  ];\n}\n\nexport async function loadImageInfo(url: string): Promise<{ width: number; height: number }> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => {\n      resolve({ width: img.naturalWidth, height: img.naturalHeight });\n    };\n    img.onerror = () => reject(new Error(\"Image load failed\"));\n    const cacheBust = url.includes(\"?\") ? \"&\" : \"?\";\n    img.src = `${url}${cacheBust}cacheBust=${Date.now()}`;\n  });\n}\n\nexport async function pickBestThumbnail(id: string): Promise<ThumbnailVariant | null> {\n  const variants = makeCandidates(id);\n\n  for (const variant of variants) {\n    try {\n      const { width } = await loadImageInfo(variant.url);\n      if (width >= 640) {\n        return variant;\n      }\n      if (variant.name !== \"maxres\") {\n        return variant;\n      }\n    } catch {\n      // try next\n    }\n  }\n\n  return null;\n}\n", "import { downloadAsFile } from \"./download\";\nimport { extractVideoId, pickBestThumbnail } from \"./youtube\";\n\nconst urlInput = document.querySelector<HTMLInputElement>(\"#url-input\");\nconst downloadButton = document.querySelector<HTMLButtonElement>(\"#download-btn\");\nconst statusEl = document.querySelector<HTMLDivElement>(\"#status\");\nconst cardEl = document.querySelector<HTMLElement>(\".card\");\n\nif (!urlInput || !downloadButton || !statusEl || !cardEl) {\n  throw new Error(\"Required DOM elements not found\");\n}\n\nfunction setStatus(message: string): void {\n  statusEl.textContent = message;\n}\n\nfunction setInputError(hasError: boolean): void {\n  urlInput.classList.toggle(\"input-error\", hasError);\n  urlInput.setAttribute(\"aria-invalid\", hasError ? \"true\" : \"false\");\n}\n\nfunction setLoading(isLoading: boolean): void {\n  downloadButton.disabled = isLoading;\n  downloadButton.textContent = isLoading ? \"\u0421\u043A\u0430\u0447\u0438\u0432\u0430\u044E\u2026\" : \"\u0421\u043A\u0430\u0447\u0430\u0442\u044C\";\n}\n\nasync function handleDownload(): Promise<void> {\n  setStatus(\"\");\n  setInputError(false);\n  cardEl.classList.add(\"is-animating\");\n  window.setTimeout(() => {\n    cardEl.classList.remove(\"is-animating\");\n  }, 420);\n\n  const videoId = extractVideoId(urlInput.value);\n  if (!videoId) {\n    setInputError(true);\n    return;\n  }\n\n  setLoading(true);\n\n  try {\n    const best = await pickBestThumbnail(videoId);\n    if (!best) {\n      setStatus(\"\u041D\u0435 \u043D\u0430\u0448\u0451\u043B \u043E\u0431\u043B\u043E\u0436\u043A\u0443 \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u0432\u0438\u0434\u0435\u043E.\");\n      return;\n    }\n\n    const filename = `youtube-${videoId}-${best.name}.jpg`;\n\n    try {\n      await downloadAsFile(best.url, filename);\n      setStatus(\"\");\n    } catch {\n      setStatus(\n        `\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043A\u0430\u0447\u0430\u0442\u044C \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438. \u041E\u0442\u043A\u0440\u043E\u0439\u0442\u0435 \u0441\u0441\u044B\u043B\u043A\u0443 \u0432\u0440\u0443\u0447\u043D\u0443\u044E: ${best.url}`,\n      );\n    }\n  } finally {\n    setLoading(false);\n  }\n}\n\ndownloadButton.addEventListener(\"click\", handleDownload);\nurlInput.addEventListener(\"input\", () => {\n  setInputError(false);\n});\nurlInput.addEventListener(\"keydown\", (event) => {\n  if (event.key === \"Enter\") {\n    handleDownload();\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
